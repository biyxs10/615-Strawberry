---
title: "Strawberry Cleaning"
author: "Xiaohan Shi"
date: "2024-10-02"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Step 1: Install packages & Read data
```{r}
library(tidyverse)
library(knitr)  
library(kableExtra)
library(stringr)
strawberry<-read.csv("strawberries25_v3.csv")
glimpse(strawberry)
```
**It shows a general view of data.**

```{r}
sum(strawberry$Domain == "TOTAL")
sum(strawberry$Domain == "TOTAL")
state_all <- strawberry |> distinct(State)
state_all1 <- strawberry |> group_by(State) |> count()
```


## Step 2: Drop the columns that have a single value. 
## The reason is that the value of this column is the same in every row, so it won't contribute anything to data analysis, modeling, or forecasting. It does not help to distinguish between different observations. 
```{r}
drop_one_value_col <- function(df){
drop <- NULL
for(i in 1:dim(df)[2]){
if((df |> distinct(df[,i]) |> count()) == 1){
drop = c(drop, i)
} }

if(is.null(drop)){return("none")}else{

   print("Columns dropped:")
   print(colnames(df)[drop])
   strawberry <- df[, -1*drop]
   }
}
strawberry <- drop_one_value_col(strawberry)
drop_one_value_col(strawberry)
```
**By dropping the Columns with a single value, it makes the data easier to understand and process.**


## Step 3: understand the data by analysis the data sources.
```{r}
calif <- strawberry |> filter(State=="CALIFORNIA")
unique(calif$Program)
#It can be seen that there are two different kinds of data sources.
```
```{r}
#Analysis the difference between two data sources.
calif_census <- calif |> filter(Program=="CENSUS")
calif_survey  <- calif |>  filter(Program=="SURVEY")
```
**The comparison shows that the values of these variables in the survey data are NA: "Ag.District", "Ag.District.Code", "Country", "Country.ANSI", "CV...". The reason might be that surveys are usually smaller, more frequent data collection activities, and censuses are usually collect large-scale data periodicly. Thus censuses data source may have more comprehensive data.**


## Step 4: Tidy column variables.
## a) Some data is collected in the same column (Data.Item), it needs to be split into different columns and also add new variables.
```{r}
strawberry <- strawberry |>
  separate(
    col = `Data.Item`,           
    into = c("Fruit", "Rest"),   
    sep = " - ",                 
    remove = FALSE,              
    extra = "merge",             
    fill = "right"               
  )

# split 'Rest' into 'Measure' and 'Bearing_type': 
strawberry <- strawberry |>
  separate(
    col = Rest,
    into = c("Measure", "Bearing_type"),  
    sep = "(?<=(ACRES|WITH))",    # separate by 'ACRES' AND 'WITH', and keep 'ACRES' in following columns.
    remove = FALSE,                     
    extra = "merge",                      
    fill = "left"                         
  ) |>
  select(-Rest, -Fruit, -Data.Item) 
```


## Step 5: Change the exception character in 'VALUE' to NA.
```{r}
footnotes_v <- strawberry %>%
   filter(!is.na(Value) & !grepl("^[0-9]+(\\.[0-9]+)?(,[0-9]{1,3})*$", Value)) %>%  
  distinct(Value)
strawberry <- strawberry %>% mutate(Value = na_if(Value, "(NA)"))
strawberry$Value<-as.numeric(str_replace(strawberry$Value,",",""))
```

## Export the cleared data.
```{r}
write.csv(strawberry, file = "cleaned_strawberry_data.csv", row.names = FALSE)
```

